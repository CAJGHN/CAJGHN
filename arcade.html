<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CAJGHN Arcade</title>
  <style>
    html,body{height:100%;margin:0;background:#f2f2f2;color:#000;font-family:Inter,system-ui,Arial}
    .wrap{display:flex;flex-direction:column;height:100vh}
    header{padding:10px 14px;background:#fff;display:flex;align-items:center;gap:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
    header h1{font-size:16px;margin:0;color:#222}
    header .spacer{flex:1}
    header .btn{background:#eee;color:#000;border:none;padding:8px 12px;border-radius:6px;font-size:13px;cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,0.05)}
    header .btn:active{transform:translateY(1px)}
    #game-container{flex:1;display:flex;align-items:center;justify-content:center;position:relative}
    canvas{background:#e6e6e6;width:100%;max-width:1100px;height:calc(100vh - 70px);box-shadow:0 10px 30px rgba(0,0,0,0.1);border-radius:8px}
    .hud{position:absolute;right:16px;top:16px;color:#333;font-size:14px;text-align:right}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{background:#fff;border-radius:10px;padding:20px;max-width:740px;width:90%;box-shadow:0 20px 50px rgba(0,0,0,0.2);font-size:15px;color:#111}
    .modal h2{margin:0 0 8px 0;font-size:18px}
    .modal p{margin:8px 0;line-height:1.45}
    .modal .close{margin-top:14px;display:inline-block;background:#eee;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>CAJGHN Arcade</h1>
      <div class="spacer"></div>
      <button class="btn" id="rulesBtn">Rules</button>
    </header>

    <div id="game-container">
      <canvas id="game"></canvas>
      <div class="hud" id="hud"></div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
      <h2 id="rulesTitle">Game Rules</h2>
      <p>Controls: Move with WASD or arrow keys. Press R to restart the game.</p>
      <p>Pause: Press Spacebar to pause/resume the game. The game will also pause automatically when the Rules window is open.</p>
      <p>Toggle Guide: Press K to show/hide control guide.</p>
      <p>Coins: Collect coins to increase your score. Each coin gives +10 points.</p>
      <p>Enemies: Colliding with enemies reduces your HP by 1.</p>
      <p>Scaling difficulty: Every time your score reaches a multiple of 100 points, one additional enemy is spawned.</p>
      <p>Invincibility: When you reach each 100-point milestone you gain 1.5 seconds of invincibility. The game also grants 3 seconds of invincibility at the very start of a run.</p>
      <p>Game Over: If your HP reaches 0 the game pauses and shows GAME OVER. Press R to restart.</p>
      <button class="close" id="closeRules">Close</button>
    </div>
  </div>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
let W=1000,H=700;
function resize(){
  const ratio=window.devicePixelRatio||1;
  const maxW=Math.min(window.innerWidth-40,1100);
  const maxH=window.innerHeight-120;
  W=Math.max(700,Math.min(maxW,1100));
  H=Math.max(520,Math.min(maxH,800));
  canvas.width=Math.floor(W*ratio);
  canvas.height=Math.floor(H*ratio);
  canvas.style.width=W+'px';
  canvas.style.height=H+'px';
  ctx.setTransform(ratio,0,0,ratio,0,0);
}
window.addEventListener('resize',resize);
resize();
const state={
  keys:{},
  player:{x:W/2,y:H*0.6,vx:0,vy:0,speed:180,hp:5,score:0,alive:true,invincible:3},
  objects:[],
  lastTime:0,
  paused:false,
  started:false,
  showKeys:true
};
function rand(a,b){return Math.random()*(b-a)+a}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}
window.addEventListener('keydown',e=>{
  if(!state.started){state.started=true;return;}
  state.keys[e.key.toLowerCase()]=true;
  if(e.key==='r'||e.key==='R') restart();
  if(e.code==='Space') togglePause();
  if(e.key==='k'||e.key==='K') state.showKeys=!state.showKeys;
  if(e.key==='Escape') hideRules();
});
window.addEventListener('keyup',e=>{state.keys[e.key.toLowerCase()]=false;});
function spawnPickup(x,y){state.objects.push({type:'pickup',x,y,r:10,collected:false});}
function spawnEnemy(x,y){state.objects.push({type:'enemy',x,y,w:36,h:48,dir:Math.random()<0.5?-1:1,speed:40+Math.random()*40,vyDir:Math.random()<0.5?-1:1,vySpeed:20+Math.random()*30,hp:1});}
function initMap(){
  state.objects=[];
  for(let i=0;i<10;i++)spawnPickup(rand(80,W-80),rand(120,H-120));
  for(let i=0;i<5;i++)spawnEnemy(rand(80,W-80),rand(120,H-120));
  const p=state.player;
  p.x=W/2;p.y=H*0.6;p.hp=5;p.score=0;p.alive=true;p.invincible=3;
  state.paused=false;
}
initMap();
function restart(){initMap();}
function togglePause(){
  if(!state.started||!state.player.alive)return;
  state.paused=!state.paused;
}
function update(dt){
  if(!state.started||state.paused)return;
  const p=state.player;
  let ax=0,ay=0;
  if(state.keys['arrowleft']||state.keys['a'])ax-=1;
  if(state.keys['arrowright']||state.keys['d'])ax+=1;
  if(state.keys['arrowup']||state.keys['w'])ay-=1;
  if(state.keys['arrowdown']||state.keys['s'])ay+=1;
  const len=Math.hypot(ax,ay)||1;
  p.vx=(ax/len)*p.speed;
  p.vy=(ay/len)*p.speed;
  p.x+=p.vx*dt;p.y+=p.vy*dt;
  p.x=Math.max(40,Math.min(W-40,p.x));
  p.y=Math.max(80,Math.min(H-40,p.y));
  if(p.invincible>0)p.invincible-=dt;
  for(const o of state.objects){
    if(o.type==='enemy'){
      o.x+=o.dir*o.speed*dt;o.y+=o.vyDir*o.vySpeed*dt;
      if(o.x<60||o.x>W-60)o.dir*=-1;
      if(o.y<120||o.y>H-120)o.vyDir*=-1;
      if(dist(p,o)<28+(o.w/2)){
        if(p.invincible<=0 && !o._hitTimer){
          o._hitTimer=0.6;
          p.hp-=1;
          p.invincible=1.5;
        }
      }
      if(o._hitTimer){o._hitTimer-=dt;if(o._hitTimer<=0)o._hitTimer=0}
    }
  }
  for(const o of state.objects)if(o.type==='pickup'&&!o.collected)
    if(dist(p,o)<30){
      o.collected=true;state.player.score+=10;
      spawnPickup(rand(80,W-80),rand(120,H-120));
      if(state.player.score%100===0){
        spawnEnemy(rand(80,W-80),rand(120,H-120));
        state.player.invincible+=1.5;
      }
    }
  state.objects=state.objects.filter(o=>{
    if(o.type==='enemy')return o.hp>0;
    if(o.type==='pickup')return!o.collected;
    return true;
  });
  if(p.hp<=0){p.alive=false;p.hp=0;state.paused=true}
}
function render(){
  ctx.clearRect(0,0,W,H);
  ctx.save();ctx.fillStyle='#e6e6e6';ctx.fillRect(0,0,W,H);ctx.restore();
  if(!state.started){
    ctx.fillStyle='#000';ctx.font='24px system-ui';ctx.textAlign='center';
    ctx.fillText('Press Any Key to Start',W/2,H/2);
    ctx.textAlign='left';return;
  }
  const drawables=[];
  for(const o of state.objects)drawables.push(o);
  drawables.push({type:'player',x:state.player.x,y:state.player.y});
  drawables.sort((a,b)=>(a.y||0)-(b.y||0));
  for(const obj of drawables){
    if(obj.type==='pickup'){
      ctx.save();const s=1+(obj.y-H*0.4)/(H*0.6)*0.6;ctx.translate(obj.x,obj.y);ctx.scale(s,s);
      ctx.beginPath();ctx.fillStyle='#ffd700';ctx.arc(0,0,10,0,Math.PI*2);ctx.fill();ctx.restore();
    }else if(obj.type==='enemy'){
      const pLike={x:obj.x,y:obj.y};const scale=0.8+(obj.y-H*0.4)/(H*0.6)*0.9;
      ctx.save();ctx.translate(pLike.x,pLike.y);
      ctx.beginPath();ctx.fillStyle='rgba(0,0,0,0.1)';ctx.ellipse(0,18*scale,22*scale,8*scale,0,0,Math.PI*2);ctx.fill();
      ctx.beginPath();ctx.fillStyle='#cc6666';ctx.arc(0,-6*scale,16*scale,0,Math.PI*2);ctx.fill();
      ctx.beginPath();ctx.fillStyle='#cc6666';ctx.arc(0,-6*scale,8*scale,0,Math.PI*2);ctx.fill();
      ctx.fillStyle='#cc6666';ctx.fillRect(-10*scale,6*scale,20*scale,12*scale);ctx.restore();
    }else if(obj.type==='player'){
      const p=state.player;const scale=0.8+(p.y-H*0.4)/(H*0.6)*0.9;
      ctx.save();ctx.translate(p.x,p.y);
      let visible=true;
      if(p.invincible>0)visible=Math.floor(Date.now()/100)%2===0;
      if(visible){
        ctx.beginPath();ctx.fillStyle='rgba(0,0,0,0.1)';ctx.ellipse(0,18*scale,22*scale,8*scale,0,0,Math.PI*2);ctx.fill();
        ctx.beginPath();ctx.fillStyle='#66aaff';ctx.arc(0,-6*scale,16*scale,0,Math.PI*2);ctx.fill();
        ctx.beginPath();ctx.fillStyle='#66aaff';ctx.arc(0,-6*scale,8*scale,0,Math.PI*2);ctx.fill();
        ctx.fillStyle='#66aaff';ctx.fillRect(-10*scale,6*scale,20*scale,12*scale);
      }
      ctx.restore();
    }
  }
  ctx.save();ctx.fillStyle='#000';ctx.font='14px system-ui';ctx.textAlign='right';
  ctx.fillText(`HP: ${state.player.hp}`,W-24,34);
  ctx.fillText(`Score: ${state.player.score}`,W-24,56);
  if(state.showKeys){
    ctx.textAlign='center';
    ctx.font='13px system-ui';
    ctx.fillText('Move: WASD / Arrows | Pause: Space | Restart: R | Toggle Guide: K',W/2,H-20);
    ctx.textAlign='right';
  }
  ctx.restore();
  if(state.paused&&!state.player.alive){ctx.fillStyle='#000';ctx.font='22px system-ui';ctx.textAlign='center';ctx.fillText('GAME OVER',W/2,H/2-5);ctx.font='14px system-ui';ctx.fillText('Press R to Restart',W/2,H/2+20);ctx.textAlign='left'}
  else if(state.paused&&state.player.alive){ctx.fillStyle='#000';ctx.font='20px system-ui';ctx.textAlign='center';ctx.fillText('PAUSED',W/2,H/2);ctx.textAlign='left'}
}
function loop(timestamp){const dt=(timestamp-state.lastTime)/1000||0.016;state.lastTime=timestamp;update(dt);render();requestAnimationFrame(loop)}
requestAnimationFrame(loop);
const hud=document.getElementById('hud');hud.innerHTML='';
const rulesBtn=document.getElementById('rulesBtn');
const modalOverlay=document.getElementById('modalOverlay');
const closeRules=document.getElementById('closeRules');
function showRules(){
  if(!state.paused)state.paused=true;
  modalOverlay.style.display='flex';
  modalOverlay.setAttribute('aria-hidden','false');
}
function hideRules(){modalOverlay.style.display='none';modalOverlay.setAttribute('aria-hidden','true');}
rulesBtn.addEventListener('click',showRules);
closeRules.addEventListener('click',hideRules);
modalOverlay.addEventListener('click',e=>{if(e.target===modalOverlay)hideRules();});
</script>
</body>
</html>
